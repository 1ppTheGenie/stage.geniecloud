{"version":3,"file":"LeafletMap.js","sources":["../../../../../../genie-components/src/utilities/maps.js","../../../../../../genie-components/src/components/LeafletMap.jsx"],"sourcesContent":["export const initAutocomplete = callback => {\r\n\tif ( !document.getElementById( \"google-maps-script\" ) ) {\r\n\t\tvar js = document.createElement(\"script\");\r\n\t\tjs.async  = true;\r\n\t\tjs.src = `https://maps.googleapis.com/maps/api/js?key=${window.gHub.googleKey}&libraries=places`;\r\n\t\tjs.id = \"google-maps-script\";\r\n\t\tjs.onload = () => callback();\r\n\r\n\t\tvar ref = document.getElementsByTagName(\"script\")[0];\r\n\t\tref.parentNode.insertBefore(js, ref);\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n};\r\n\r\nexport const initMaps = async () => {\r\n\tawait new Promise(resolve => {\r\n\t\tif (!document.getElementById(\"leaflet-script\")) {\r\n\t\t\tvar link = document.createElement(\"link\");\r\n\t\t\tlink.rel = \"stylesheet\";\r\n\t\t\tlink.type = \"text/css\";\r\n\t\t\tlink.href =\r\n\t\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css\";\r\n\t\t\tdocument.head.appendChild(link);\r\n\r\n\t\t\tvar script = document.createElement(\"script\");\r\n\t\t\tscript.src =\r\n\t\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js\";\r\n\t\t\tscript.id = \"leaflet-script\";\r\n\t\t\tscript.onload = () => resolve(true);\r\n\t\t\tdocument.head.appendChild(script);\r\n\t\t} else {\r\n\t\t\t(async () => {\r\n\t\t\t\twhile (!window.L) {\r\n\t\t\t\t\tawait new Promise(r => setTimeout(r, 250));\r\n\t\t\t\t}\r\n\t\t\t\tresolve(true);\r\n\t\t\t})();\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport const buildMap = (container, options = {}) => {\r\n\tif (window.L && container && !container.classList.contains(\"leaflet-container\")) {\r\n\t\tconst center = options.center || { lat: 32.715, lng: -117.1611 };\r\n\t\tconst mapStyle = options.mapStyle || window.gHub.mapStyle;\r\n\r\n\t\tconst mapboxTiles = window.L.tileLayer(\r\n\t\t\t`https://api.mapbox.com/styles/v1/mapbox/${mapStyle}/tiles/{z}/{x}/{y}?access_token=${window.gHub.mapboxKey}`,\r\n\t\t\t{\r\n\t\t\t\tattribution:\r\n\t\t\t\t\t'&copy; <a href=\"https://www.mapbox.com/feedback/\">Mapbox</a>',\r\n\t\t\t\ttileSize: 512,\r\n\t\t\t\tzoomOffset: -1,\r\n\t\t\t}\r\n\t\t);\r\n\t\t\r\n\t\ttry {\r\n\t\t\treturn window.L.map( container, {\r\n\t\t\t\tcenter: [center.lat, center.lng],\r\n\t\t\t\tzoomControl: false, //options.zoomCtl\r\n\t\t\t\tscrollWheelZoom: false, //options.scrollCtl\r\n\t\t\t\tlayers: [mapboxTiles],\r\n\t\t\t\tattributionControl: false,\r\n\t\t\t\tzoom: 13,\r\n\t\t\t\tdragging: false,\r\n\t\t\t\t...options\r\n\t\t\t} );\r\n\t\t} catch  { }\r\n\t}\r\n};\r\n","import {\r\n\tonMount,\r\n\tcreateContext,\r\n\tuseContext,\r\n\tcreateEffect,\r\n\tcreateResource,\r\n\tcreateSignal,\r\n\tShow,\r\n} from \"solid-js\";\r\n\r\nimport { initMaps, buildMap, getAreaPolygon } from \"@/utilities\";\r\n\r\nconst MapContext = createContext();\r\n\r\nexport const LeafletMap = props => {\r\n\tconst [map, setMap] = createSignal();\r\n\tconst { id = \"genie-map\", center, cssClasses, style, mapStyle, zoom } = props;\r\n\tlet refMap;\r\n\r\n\tonMount(() => {\r\n\t\t(async () => {\r\n\t\t\tawait initMaps();\r\n\r\n\t\t\tconst leafletMap = buildMap(refMap, {\r\n\t\t\t\tmapStyle,\r\n\t\t\t\tcenter: center ? new window.L.LatLng(center[0], center[1]) : null,\r\n\t\t\t\tzoom,\r\n\t\t\t\tdragPan: false,\r\n\t\t\t});\r\n\r\n\t\t\tif (leafletMap) setMap(leafletMap);\r\n\r\n\t\t\tconst cleanDirtyMap = () => {\r\n\t\t\t\tmap() && map().invalidateSize();\r\n\t\t\t};\r\n\t\t\trefMap.addEventListener(\"transitionend\", cleanDirtyMap);\r\n\t\t\tconst resizeObserver = new ResizeObserver(cleanDirtyMap);\r\n\t\t\tresizeObserver.observe(document.getElementById(id));\r\n\t\t})();\r\n\t});\r\n\r\n\tcreateEffect(() => {\r\n\t\tmap() &&\r\n\t\t\tcenter &&\r\n\t\t\twindow.L &&\r\n\t\t\tmap().panTo(new window.L.LatLng(center[0], center[1]));\r\n\t});\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div ref={refMap} id={id} class={cssClasses} style={style} />\r\n\t\t\t<Show when={map()}>\r\n\t\t\t\t<MapContext.Provider value={map}>{props.children}</MapContext.Provider>\r\n\t\t\t</Show>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport const GeoArea = props => {\r\n\tconst [polygon] = createResource(props.areaId, getAreaPolygon);\r\n\r\n\treturn <Geo polygon={polygon()} color={props.color} />;\r\n};\r\n\r\nexport const Geo = props => {\r\n\tconst [geoJSON, setGeoJSON] = createSignal();\r\n\tconst map = useContext(MapContext);\r\n\tconst { fitBounds = true, fillColor = \"#E9B760\" } = props;\r\n\r\n\tcreateEffect(() => {\r\n\t\tif (map && props.polygon && typeof props.polygon.geoJSON != \"undefined\") {\r\n\t\t\tsetGeoJSON(JSON.parse(props.polygon.geoJSON));\r\n\t\t}\r\n\t});\r\n\r\n\tcreateEffect(() => {\r\n\t\tif (geoJSON()) {\r\n\t\t\twindow.L.geoJSON(geoJSON(), {\r\n\t\t\t\tstyle: () => ({ color: fillColor }),\r\n\t\t\t\tonEachFeature: (feature, layer) => {\r\n\t\t\t\t\tif (fitBounds) {\r\n\t\t\t\t\t\tmap().fitBounds(layer.getBounds(), { zoom: 22 });\r\n\t\t\t\t\t\tmap().invalidateSize();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t}).addTo(map());\r\n\t\t}\r\n\t});\r\n\r\n\treturn null;\r\n};\r\n\r\nexport const LeafletPane = props => {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclass=\"leaflet-pane\"\r\n\t\t\tstyle=\"position: absolute; width: 100%; height: 100%; display: flex; align-Items: center; justify-Content:center; z-index: 9999;\">\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport const CircleMarker = ({ color, caption, position }) => {\r\n\tconst url = circleURI(color, caption);\r\n\t/*\r\n\tconst svgIcon =\r\n\t\twindow.L &&\r\n\t\tnew window.L.icon({\r\n\t\t\ticonUrl: url,\r\n\t\t\ticonSize: [34, 34],\r\n\t\t\ticonAnchor: [12, 12],\r\n\t\t});\r\n\t\t\r\n\t\ticon={svgIcon} \r\n\t\t*/\r\n\r\n\treturn <Marker position={position} />;\r\n};\r\n\r\nexport const Marker = props => {\r\n\tconst map = useContext(MapContext);\r\n\tconst { position } = props;\r\n\r\n\tcreateEffect(() => {\r\n\t\tif (map() && position && window.L) {\r\n\t\t\twindow.L.marker(position, { ...props }).addTo(map());\r\n\t\t}\r\n\t});\r\n\r\n\treturn null;\r\n};\r\n\r\nexport const circleURI = (color, caption = \"\", size = 12) => {\r\n\tconst text =\r\n\t\tcaption === \"\"\r\n\t\t\t? \"\"\r\n\t\t\t: `<text x=\"12\" y=\"16\" fill=\"#fff\" text-anchor=\"middle\" style=\"font-family:sans-serif;font-weight:800;font-size:12px\">${caption}</text>`;\r\n\r\n\tconst svg = `\r\n\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size * 2 + 4}\" height=\"${\r\n\t\tsize * 2 + 4\r\n\t}\">\r\n\t\t<defs>\r\n\t\t\t<filter id=\"shadow\" x=\"0\" y=\"0\" width=\"${size}\" height=\"${size}\">\r\n\t\t\t\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"3\"/> \r\n\t\t\t\t<feOffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>\r\n\t\t\t\t<feComponentTransfer>\r\n\t\t\t\t\t<feFuncA type=\"linear\" slope=\"0.5\"/>\r\n\t\t\t\t</feComponentTransfer>\r\n\t\t\t\t<feMerge> \r\n\t\t\t\t\t<feMergeNode/> \r\n\t\t\t\t\t<feMergeNode in=\"SourceGraphic\"/> \r\n\t\t\t\t</feMerge>\r\n\t\t\t</filter>\r\n\t\t</defs>\r\n\t\t<circle fill=\"${color}\" cx=\"${size}\" cy=\"${size}\" r=\"${size}\" filter=\"url(#shadow)\" />\r\n\t\t${text}\r\n\t</svg>`;\r\n\r\n\treturn \"data:image/svg+xml,\" + encodeURIComponent(svg);\r\n};\r\n"],"names":["initAutocomplete","callback","js","ref","initMaps","resolve","r","link","script","buildMap","container","options","center","mapStyle","mapboxTiles","MapContext","createContext","LeafletMap","props","map","setMap","createSignal","id","cssClasses","style","zoom","refMap","onMount","leafletMap","window","L","LatLng","dragPan","cleanDirtyMap","invalidateSize","addEventListener","ResizeObserver","observe","document","getElementById","createEffect","panTo","_el$","_tmpl$","_ref$","_$use","_$className","_$effect","_$style","_$p","_$createComponent","Show","when","children","Provider","value","GeoArea","polygon","createResource","areaId","getAreaPolygon","Geo","color","geoJSON","setGeoJSON","useContext","fitBounds","fillColor","JSON","parse","onEachFeature","feature","layer","getBounds","addTo","LeafletPane","_el$2","_tmpl$2","CircleMarker","caption","position","Marker","marker"],"mappings":"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"}