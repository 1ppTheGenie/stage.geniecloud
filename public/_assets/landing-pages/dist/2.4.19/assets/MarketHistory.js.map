{"version":3,"file":"MarketHistory.js","sources":["../../../../../../genie-components/src/components/LineChart.jsx","../../../../../../genie-components/src/embeds/MarketHistory.jsx"],"sourcesContent":["import { createResource } from \"solid-js\";\r\n\r\nimport \"@/assets/css/charts.css\";\r\n\r\nlet genieCharts;\r\n\r\nexport const LineChart = props => {\r\n\tconst [charts] = createResource(loadCharts);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{!charts.loading &&\r\n\t\t\t\tgenieCharts.draw(\"90%\", \"70%\", props.data, props.element)}\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nconst loadCharts = () =>\r\n\tnew Promise(resolve => {\r\n\t\tif (!document.getElementById(\"genie-charts\")) {\r\n\t\t\tvar link = document.createElement(\"link\");\r\n\t\t\tlink.rel = \"stylesheet\";\r\n\t\t\tlink.type = \"text/css\";\r\n\t\t\tlink.href =\r\n\t\t\t\t\"https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css\";\r\n\t\t\tdocument.head.appendChild(link);\r\n\r\n\t\t\tvar script = document.createElement(\"script\");\r\n\t\t\tscript.src =\r\n\t\t\t\t\"https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js\";\r\n\t\t\tscript.id = \"chartist-script\";\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tvar gScript = document.createElement(\"script\");\r\n\t\t\t\tgScript.src = `${window.gHub.siteUrl}_assets/_js/charts.js`;\r\n\t\t\t\tgScript.id = \"genie-charts\";\r\n\r\n\t\t\t\tgScript.onload = () => {\r\n\t\t\t\t\tgenieCharts = window.genieChart.initCharts();\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t};\r\n\t\t\t\tdocument.head.appendChild(gScript);\r\n\t\t\t};\r\n\t\t\tdocument.head.appendChild(script);\r\n\t\t} else {\r\n\t\t\tresolve(true);\r\n\t\t}\r\n\t});\r\n","import { createSignal, createEffect, Show } from \"solid-js\";\r\nimport { areaMonthlyStore, areaDataStore } from \"@/utilities\";\r\nimport { format } from \"date-fns\";\r\nimport { HomeTypes, Editable, LineChart } from \"@/components\";\r\n\r\nimport \"@/assets/css/market-history.css\";\r\n\r\nconst link = document.createElement(\"link\");\r\nlink.rel = \"stylesheet\";\r\nlink.type = \"text/css\";\r\nlink.href = \"https://cdn.rawgit.com/tiaanduplessis/wenk/master/dist/wenk.css\";\r\ndocument.head.appendChild(link);\r\n\r\nexport default () => {\r\n\tconst [graphView, setGraphView] = createSignal(\"averagePricePerSqFt\");\r\n\tconst [series, setSeries] = createSignal();\r\n\tconst [labels, setLabels] = createSignal();\r\n\tconst [high, setHigh] = createSignal();\r\n\tconst [low, setLow] = createSignal();\r\n\r\n\tcreateEffect(() => {\r\n\t\tif (areaMonthlyStore.loading == false) {\r\n\t\t\tconst stats = areaMonthlyStore.stats.filter(\r\n\t\t\t\tstats => stats.propertyTypeId === areaDataStore.propertyTypeID\r\n\t\t\t);\r\n\r\n\t\t\tsetLabels(\r\n\t\t\t\tstats\r\n\t\t\t\t\t.slice(Math.max(stats.length - areaDataStore.areaPeriod, 1))\r\n\t\t\t\t\t.map(m => format(new Date(m.yearPart, m.monthPart - 1, 1), \"MMM yy\"))\r\n\t\t\t);\r\n\t\t\tconst series = stats\r\n\t\t\t\t.slice(Math.max(stats.length - areaDataStore.areaPeriod, 1))\r\n\t\t\t\t.map(m => ({\r\n\t\t\t\t\tname: format(new Date(m.yearPart, m.monthPart - 1, 1), \"MMM yy\"),\r\n\t\t\t\t\tvalue: m[graphView()],\r\n\t\t\t\t}));\r\n\r\n\t\t\tsetSeries(series);\r\n\r\n\t\t\tconst min = Math.min.apply(\r\n\t\t\t\t9999999999999,\r\n\t\t\t\tseries.map(i => i.value)\r\n\t\t\t);\r\n\t\t\tconst max = Math.max.apply(\r\n\t\t\t\t0,\r\n\t\t\t\tseries.map(i => i.value)\r\n\t\t\t);\r\n\t\t\tswitch (graphView) {\r\n\t\t\t\tcase \"averagePricePerSqFt\":\r\n\t\t\t\t\tsetLow(Math.round(min / 1.4 / 250000) * 250000);\r\n\t\t\t\t\tsetHigh(Math.ceil((max * 1.3) / 250000) * 250000);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"averageSalePrice\":\r\n\t\t\t\t\tsetLow(Math.round(min / 1.4 / 250) * 250);\r\n\t\t\t\t\tsetHigh(Math.ceil((max * 1.3) / 250) * 250);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsetLow(min / 1.4);\r\n\t\t\t\t\tsetHigh(max * 1.3);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Editable style=\"text-align:center\" id=\"market-history-title\">\r\n\t\t\t\t<h1>\r\n\t\t\t\t\tA History of the\r\n\t\t\t\t\t<br />\r\n\t\t\t\t\t{areaDataStore.areaName}&#160;Market\r\n\t\t\t\t</h1>\r\n\t\t\t</Editable>\r\n\r\n\t\t\t<HomeTypes container={`MarketHistory-`} />\r\n\r\n\t\t\t<div class=\"curved-tabs\">\r\n\t\t\t\t<span\r\n\t\t\t\t\tclass={graphView() === \"averagePricePerSqFt\" ? \"active\" : \"\"}\r\n\t\t\t\t\tonClick={() => setGraphView(\"averagePricePerSqFt\")}>\r\n\t\t\t\t\tPrice per sq/ft\r\n\t\t\t\t</span>\r\n\t\t\t\t<span\r\n\t\t\t\t\tclass={graphView() === \"averageSalePrice\" ? \"active\" : \"\"}\r\n\t\t\t\t\tonClick={() => setGraphView(\"averageSalePrice\")}>\r\n\t\t\t\t\tPrice history\r\n\t\t\t\t</span>\r\n\t\t\t\t<span\r\n\t\t\t\t\tclass={graphView() === \"soldCount\" ? \"active\" : \"\"}\r\n\t\t\t\t\tonClick={() => setGraphView(\"soldCount\")}>\r\n\t\t\t\t\tSales history\r\n\t\t\t\t</span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"market-history-chart\">\r\n\t\t\t\t<Show when={series()}>\r\n\t\t\t\t\t<LineChart\r\n\t\t\t\t\t\telement=\".market-history-chart\"\r\n\t\t\t\t\t\tmargin={{\r\n\t\t\t\t\t\t\ttop: 15,\r\n\t\t\t\t\t\t\tright: 15,\r\n\t\t\t\t\t\t\tbottom: 15,\r\n\t\t\t\t\t\t\tleft: 15,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\twidth={900}\r\n\t\t\t\t\t\theight={300}\r\n\t\t\t\t\t\tdata={{\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tlabels: labels(),\r\n\t\t\t\t\t\t\t\tseries: [series()],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t\twidth: \"100%\",\r\n\t\t\t\t\t\t\t\theight: \"100%\",\r\n\t\t\t\t\t\t\t\taxisX: {\r\n\t\t\t\t\t\t\t\t\tscaleLabel: \"Month\",\r\n\t\t\t\t\t\t\t\t\tonlyInteger: false,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\taxisY: {\r\n\t\t\t\t\t\t\t\t\thigh: high(),\r\n\t\t\t\t\t\t\t\t\tlow: low(),\r\n\t\t\t\t\t\t\t\t\toffset: 60,\r\n\t\t\t\t\t\t\t\t\tonlyInteger: true,\r\n\t\t\t\t\t\t\t\t\tlabelInterpolationFnc:\r\n\t\t\t\t\t\t\t\t\t\tgraphView() === \"soldCount\"\r\n\t\t\t\t\t\t\t\t\t\t\t? window.genieChart.number\r\n\t\t\t\t\t\t\t\t\t\t\t: window.genieChart.dollarRound,\r\n\t\t\t\t\t\t\t\t\tscaleLabel:\r\n\t\t\t\t\t\t\t\t\t\tgraphView() === \"soldCount\" ? \"Total Sold\" : \"Price\",\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}}></LineChart>\r\n\t\t\t\t</Show>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n};\r\n"],"names":["genieCharts","LineChart","props","charts","createResource","loadCharts","_$memo","loading","draw","data","element","Promise","resolve","document","getElementById","link","createElement","rel","type","href","head","appendChild","script","src","id","onload","gScript","window","gHub","siteUrl","genieChart","initCharts","MarketHistory","graphView","setGraphView","createSignal","series","setSeries","labels","setLabels","high","setHigh","low","setLow","createEffect","areaMonthlyStore","stats","filter","propertyTypeId","areaDataStore","propertyTypeID","slice","Math","max","length","areaPeriod","map","format","Date","m","yearPart","monthPart","name","value","min","apply","i","round","ceil","_$createComponent","Editable","style","children","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","_el$4","_$insert","areaName","HomeTypes","container","_el$5","_tmpl$2","_el$6","_el$7","_el$8","$$click","_$effect","_p$","_v$","_v$2","_v$3","e","_$className","t","a","undefined","_el$9","_tmpl$3","Show","when","margin","top","right","bottom","left","width","height","options","axisX","scaleLabel","onlyInteger","axisY","offset","labelInterpolationFnc","number","dollarRound","_$delegateEvents"],"mappings":"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"}